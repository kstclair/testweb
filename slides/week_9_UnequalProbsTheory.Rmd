---
title: "Sampling with unqual probabilities of selection (WOR) - theory"
author: "Stat 260, St. Clair"
subtitle: "Week 9 (6.4)"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r, include=FALSE}
knitr::opts_chunk$set(collapse=TRUE, prompt=TRUE, comment=NULL,tidy.opts=list(width.cutoff=60),tidy=FALSE,eval=TRUE,eval=TRUE, warning=FALSE, message  = FALSE, fig.width = 11, fig.height = 7)
```


### Horvitz-Thompson Estimator

$$\hat{t}_{HT} = \sum_{i =1}^n w_i t_i$$

Derive the variance of $\hat{t}_{HT}$:
$$Var(\hat{t}_{HT}) =  \sum_{i=1}^{N} \dfrac{1-\pi_{i}}{\pi_{i}}t^{2}_{i}+2 \mathop{\sum_{i=1}^{N}\sum_{k=1}^{N}}_{i< k} \dfrac{\pi_{ik} - \pi_{i}\pi_{k}}{\pi_{i}\pi_{k}}t_{i}t_{k}$$

---

---

---

### Horvitz-Thompson Estimator


- **SRS:** We measure $t_i = y_i$ for each unit and $\hat{t}_{HT} = N\bar{y}$. 
$$\pi_{i} = \dfrac{\binom{N-1}{n-1}}{\binom{N}{n}}  = \dfrac{n}{N}  \ \ \ \ \ \ \ \pi_{ik} = \dfrac{\binom{N-2}{n-2}}{\binom{N}{n}}  = \dfrac{n(n-1)}{N(N-1)}$$

- **SRS:** variance is then
$$Var(\hat{t}_{HT}) =  \sum_{i=1}^{N} \dfrac{1-\dfrac{n}{N}}{\dfrac{n}{N}}y^{2}_{i}+2 \mathop{\sum_{i=1}^{N}\sum_{k=1}^{N}}_{i< k} \dfrac{\dfrac{n(n-1)}{N(N-1)} - \dfrac{n}{N}\dfrac{n}{N}}{\dfrac{n}{N}\dfrac{n}{N}}y_{i}y_{k} \\
....\textrm{lots of algebra}....\\
= N^2(1-\dfrac{n}{N})\dfrac{S^2}{n}$$

Fill in the missing work...

---

---

---


---


### Estimating HT variance


$$Var(\hat{t}_{HT}) =  \sum_{i=1}^{N} \dfrac{1-\pi_{i}}{\pi_{i}}t^{2}_{i}+2 \mathop{\sum_{i=1}^{N}\sum_{k=1}^{N}}_{i< k} \dfrac{\pi_{ik} - \pi_{i}\pi_{k}}{\pi_{i}\pi_{k}}t_{i}t_{k}$$

Derive the HT-estimator of $Var(\hat{t}_{HT})$


---


---

### Horvitz-Thompson Estimator


Prove that 


$$\sum_{i=1}^N \pi_i = n$$ 



---


### Horvitz-Thompson Estimator


Prove that if there are $M$ observation units in the population,
$$E(\sum_{\textrm{all sampled obs. units}} w_i) = N$$ 