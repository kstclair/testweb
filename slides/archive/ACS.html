<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Adaptive Cluster Sampling</title>
    <meta charset="utf-8" />
    <meta name="author" content="Math 255, St. Clair" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies.css" rel="stylesheet" />
    <link href="libs/remark-css/hygge.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Adaptive Cluster Sampling
### Math 255, St. Clair

---






## Adaptive designs

.large[
- *Adaptive* design: sampling units are determined "on the fly" based on observed characteristics of previously sampled units 
]
--
.large[
- Adaptive *cluster* sampling (ACS): goal is to sample rare, clustered populations

- *cluster* denotes a spatial, social or genetic "closeness"

    - rare animal/plant species that are spatially clustered
    - rare disease/trait that are spatially *or* socially or genetically clustered
]

--

.large[
- Idea of ACS:

    (1) get an initial SRS of units
    
    (2) if sampled unit `\(i\)` meet a condition `\(C\)` and add `\(i\)`s neighboring units to the sample
    
    (3) repeat (2) until no more units can be added
]

---

## Example


.large[
A simplified "strawberry field" example: how many plants (dots) in the field?
]
&lt;img src="ACS_files/figure-html/unnamed-chunk-2-1.svg" style="display: block; margin: auto;" /&gt;

---
## Example

.large[
ACS design:

- Divide the region into grid plots to create a sampling frame

- Sampling unit: grid plot (N=25)
]
---

## Example

.large[
Sampling frame grid:
]
&lt;img src="ACS_files/figure-html/unnamed-chunk-3-1.svg" style="display: block; margin: auto;" /&gt;

---
## Example

.large[
ACS design:

- define a neighborhood: 
  
    - plot `\(i\)`'s neighbors are cells to the north/south/east/west

]
---

## Example

.large[
Neighborhood of plot `\(i\)`

]

&lt;img src="ACS_files/figure-html/unnamed-chunk-4-1.svg" style="display: block; margin: auto;" /&gt;

---
## Example

.large[
ACS design:

- Determine condition `\(C\)`: we want to find the plots with plants!

    - `\(y_i =\)` number of plants in plot `\(i\)`
    - `\(C: y_i &gt; 0\)`, add neighbors if plot `\(i\)` contains plants

- All that matters in the population is units, neighborhoods and `\(y_i\)` values
]

---

## Example

.large[

Let's just look at `\(y_i\)`s 

]

&lt;img src="ACS_files/figure-html/unnamed-chunk-5-1.svg" style="display: block; margin: auto;" /&gt;
---
## Example

.large[
ACS design:

(1) Initial SRS of `\(n_1=3\)` plots and count plants `\(y_i\)`


(2) **adaptively add units:** If `\(y_i &gt; 0\)`, add plot `\(i\)`'s neighbors

(3) Repeat (2) until no more neighbors are adaptively added 
- all neighbors have `\(y_i=0\)`
]




---

## Example

.large[
(1) Initial SRS of size 3 is highlighted 
]

&lt;img src="ACS_files/figure-html/unnamed-chunk-6-1.svg" style="display: block; margin: auto;" /&gt;



---

## Example

.large[
(2) add first round of neighbors:
]

&lt;img src="ACS_files/figure-html/unnamed-chunk-7-1.svg" style="display: block; margin: auto;" /&gt;

---

## Example

.large[
(2) add second (and final!) round of neighbors:
]

&lt;img src="ACS_files/figure-html/unnamed-chunk-8-1.svg" style="display: block; margin: auto;" /&gt;

---

## Estimation

.large[
- Units have unequal selection probabilities

    - need to use a Horvitz-Thompson estimate of total!
    - units with `\(y_i &gt;0\)` have higher inclusion probabilities
]

--

.large[
- Inclusion probability for unit `\(i\)` looks like

`$$\pi_i = P(\textrm{unit } i \textrm{ is in the SRS or adaptively added})$$`

]

--

.large[
**Problem:** unless we see the *entire population*, we can't compute all `\(\pi_i\)` for observed units

- can't tell if unit `\(i\)` borders a cluster unless we've seen all units around it
]

---

## Networks instead of plots

.large[
**Solution:** define observations in terms of *networks*

- **Network:** a cluster of units generated by selection of any of the units within the cluster

- networks either
    - contain units that all satisfy condition `\(C\)`
    - are a single unit where `\(C\)` is not satisfied
]

---

## Example

.large[
Two networks satisfy `\(y_i &gt;0\)`, 19 other networks are single plot with `\(y_i=0\)`.
]

&lt;img src="ACS_files/figure-html/unnamed-chunk-9-1.svg" style="display: block; margin: auto;" /&gt;

---

## Networks

.large[
- Population has `\(K\)` distinct networks

    - Ex: `\(K = 19 + 2 = 21\)`

- Sample has `\(\kappa\)` distinct networks

    - Ex: `\(\kappa=3\)`
]

---

## Example

.large[
Three networks were sampled
]

&lt;img src="ACS_files/figure-html/unnamed-chunk-10-1.svg" style="display: block; margin: auto;" /&gt;


---

## Networks


.large[
- Let `\(y^*_k\)` be the total response of all units in network `\(k\)`
`$$y^*_k = \sum_{i \in net_k} y_i$$`

- We still have the same population total:
`$$t = \sum_{i=1}^N y_i = \sum_{k=1}^{K} y^*_k$$`

- Use HT estimator to weight the observed network totals `\(y^*_k\)`
]

---

## Network inclusion probabililities

.large[
- `\(\alpha_k\)` is the inclusion probability for network `\(k\)`:

    - network `\(k\)` is included in the ACS if **at least one** of its units is in the **initial SRS**
]

--
.large[
- Compute `\(\alpha_k\)` using the complement rule:

`$$\alpha_{k} = 1- P(\textrm{no units in } k \textrm{ are in the initial SRS})$$`
]

---

## Network inclusion probabililities
 

.large[
- There are `\(\binom{N}{n_1}\)` possible SRS of size `\(n_1\)`
]

--
.large[
- `\(x_k =\)` number of units in network `\(k\)`

- There are `\(\binom{N-x_k}{n_1}\)` possible SRS of size `\(n_1\)` that **don't contain any units** in network `\(K\)`
]

--

.large[
`$$\alpha_{k} = 1- P(\textrm{no units in } k \textrm{ are in the initial SRS}) = 1- \dfrac{\binom{N-x_{k}}{n_{1}}}{\binom{N}{n_{1}}}$$`
]


---

## Example

.large[
- Three sampled networks:

- `\(net_1 = \{1\}\)`, `\(y^*_1 = 0\)`, `\(x_1 = 1\)`, `\(\alpha_1  = 1- \dfrac{\binom{25-1}{3}}{\binom{25}{3}} = 0.12\)`

- `\(net_2 = \{2\}\)`, `\(y^*_2 = 0\)`, `\(x_2 = 1\)`, `\(\alpha_2  = 1- \dfrac{\binom{25-1}{3}}{\binom{25}{3}} = 0.12\)`
]
--

.large[
- `\(net_3 = \{3,4\}\)`, `\(y^*_3 = 10\)`, `\(x_1 = 2\)`, `\(\alpha_3  = 1- \dfrac{\binom{25-2}{3}}{\binom{25}{3}} = 0.23\)`
]

--

.large[
- Estimated total:
`$$\hat{t}_{HT} = \sum_{k=1}^{\kappa} \dfrac{y^*_k}{\alpha_k}= \dfrac{0}{0.12} +  \dfrac{0}{0.12} +  \dfrac{10}{0.23} = 43.48$$`
]
---

## Network inclusion probabililities

.large[
- Joint inclusion probability that both networks `\(j\)` and `\(k\)` are in the ACS

    - Use the rule: `\(P(j \textrm{ or } k) = P(j) + P(k) - P(j \textrm{ and } k)\)`
]

--
.large[
- So the probability of `\(j\)` **and** `\(k\)` is
`\begin{align*}
\alpha_{jk} &amp; = \alpha_j + \alpha_k -  P(j \textrm{ or } k \textrm{ in ACS}) \\
&amp; =  \alpha_j + \alpha_k - (1-P(\textrm{neither } j,k \textrm{ in ACS})) \\ 
&amp; =  \alpha_j + \alpha_k - \left( 1- \dfrac{\binom{N-x_j - x_{k}}{n_{1}} }{\binom{N}{n_{1}}} \right)
\end{align*}`

]

---

## Example

.large[
- Joint prob for networks 1 and 2:
`$$\alpha_{12} = 0.12 + 0.12 - \left( 1- \dfrac{\binom{25 - 1 - 1}{3} }{\binom{25}{3}} \right) = 0.01$$`

- Joint prob for networks 1 and 3, and also 2 and 3:
`$$\alpha_{13} = \alpha_{23} = 0.12 + 0.23 - \left( 1- \dfrac{\binom{25 - 1 - 2}{3} }{\binom{25}{3}} \right) = 0.01957$$`
]
--

.large[
- SE for `\(\hat{t}_{HT}\)`: only need to sum over non-zero network responses (and all joint products are 0!)
`$$SE_{HT}(\hat{t}_{HT}) = \sqrt{\dfrac{1-0.23}{0.23^2}10^2 + 2(0)}= 38.15$$`
]

---

## Example

.large[
- To estimate in R, enter network level data: `\(y^*_k\)` and `\(x_k\)`

```r
&gt; acs_data &lt;- data.frame(
+   y_net = c(0,0,10),
+   x_net = c(1,1,2) )
```
]
--

.large[
- Then get single network inclusion probabilities:

```r
&gt; n1 &lt;- 3
&gt; N &lt;- 25
&gt; acs_data$pi_single &lt;- 1- choose(N - acs_data$x_net,n1)/choose(N,n1)
&gt; acs_data
  y_net x_net pi_single
1     0     1      0.12
2     0     1      0.12
3    10     2      0.23
```
]

---

## Example

.large[
- Joint inclusion probabilities take more work
    - `jnt_fun` computes `\(\alpha_{jk}\)` for all `\(k=1,\dotsc, \kappa\)`

```r
&gt; jnt_fun &lt;- function(xj,x=acs_data$x_net,N=25,n1=3) 
+ { 1- choose(N - xj,n1)/choose(N,n1) - choose(N - x,n1)/choose(N,n1) + 
+     choose(N - xj-x,n1)/choose(N,n1)} 
&gt; jnt_fun(xj = 1)
[1] 0.01000000 0.01000000 0.01956522
&gt; jnt_fun(xj = 2)
[1] 0.01956522 0.01956522 0.03826087
```
]

---


## Example

.large[
- Fill the rows of the inclusion matrix:

```r
&gt; jnt_mat &lt;- matrix(
+   c(jnt_fun(acs_data$x_net[1]), 
+   jnt_fun(acs_data$x_net[2]), 
+   jnt_fun(acs_data$x_net[3])), 
+   byrow=TRUE, nrow=3)
&gt; diag(jnt_mat) &lt;- acs_data$pi_single  # fix diagonals
&gt; jnt_mat
           [,1]       [,2]       [,3]
[1,] 0.12000000 0.01000000 0.01956522
[2,] 0.01000000 0.12000000 0.01956522
[3,] 0.01956522 0.01956522 0.23000000
```

]

---

## Example

.large[
- Then use "pps" design:

```r
&gt; library(survey)
&gt; acs_design &lt;- svydesign(id = ~1, fpc= ~pi_single, 
+                         pps=ppsmat(jnt_mat), data=acs_data)
&gt; svytotal(~y_net, acs_design)
       total     SE
y_net 43.478 38.152
```

- Again, get `\(\hat{t}_{HT} = 43.48\)` and SE of 38.15.

]

--

.large[
- Note: Unless `\(n\)` is very large and clusters not "too clustered", you can't trust conventional confidence intervals for ASC data!
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
